<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin — Manage Posts</title>
  <link rel="stylesheet" href="/style.css">
  <style>
    body { font-family: Arial,sans-serif; background:#fff; padding:20px;}
    .post-card { margin:10px 0; padding:12px; border:1px solid #eee; border-radius:8px; background:#fff0f0; }
    .post-card img { width:100%; height:auto; border-radius:8px; margin-bottom:8px; object-fit:cover;}
    .delete-btn { background:#b35b46; color:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; float:right;}
  </style>
</head>
<body>
<h1>Manage Posts (Admin)</h1>
<div id="posts"></div>

<script>
const ADMIN_PASSWORD = 'admin123'; // match your server password

async function loadPosts() {
  const res = await fetch('/api/posts');
  const posts = await res.json();
  const el = document.getElementById('posts');
  if (!posts.length) return el.innerHTML = '<div>No posts</div>';

  el.innerHTML = posts.map(p => `
    <div class="post-card" data-id="${p.id}">
      ${p.image ? `<img src="${p.image}" alt="${p.title}">` : ''}
      <div style="font-weight:700">${p.title}</div>
      <div style="color:#666">${p.category || ''} • ${p.date || ''}</div>
      <button class="delete-btn">Delete</button>
    </div>
  `).join('');

  document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', async e => {
      const postCard = e.target.closest('.post-card');
      const postId = postCard.getAttribute('data-id');

      if (!confirm('Are you sure you want to delete this post?')) return;

      try {
        const res = await fetch(`/api/posts/${postId}`, {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password: ADMIN_PASSWORD })
        });
        const data = await res.json();
        if (data.success) {
          postCard.remove();
        } else {
          alert('Delete failed: ' + (data.error || 'Unknown'));
        }
      } catch (err) {
        console.error(err);
        alert('Delete failed');
      }
    });
  });
}

loadPosts();
</script>
</body>
</html>
